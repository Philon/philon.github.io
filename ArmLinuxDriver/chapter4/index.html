<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo48x48.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo48x48.png">
  <link rel="mask-icon" href="/images/logo.png" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ixx.life","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="ç”±äºLinuxä¸­ä¸€åˆ‡çš†æ–‡ä»¶çš„æ€æƒ³ï¼Œå­—ç¬¦è®¾å¤‡(é”®ç›˜&#x2F;é¼ æ ‡&#x2F;ä¸²å£)ã€å—è®¾å¤‡(å­˜å‚¨å™¨)ã€ç½‘ç»œè®¾å¤‡(å¥—æ¥å­—)ä½œä¸ºä¸‰ç§ä¸»è¦è®¾å¤‡ç±»å‹ï¼Œæˆ‘ä»¬åœ¨ç”¨æˆ·å±‚åŸºæœ¬å¯ä»¥é€šè¿‡open close read writeæ¥å®Œæˆå¯¹è®¾å¤‡çš„ç»å¤§éƒ¨åˆ†æ“ä½œã€‚å…¶ä¸­å­—ç¬¦è®¾å¤‡æ˜¯æ¶µç›–é¢æœ€å¹¿çš„ä¸€ç§ï¼Œè€Œä¸”å…¶æ¦‚å¿µç›¸å¯¹å®¹æ˜“ç†è§£ï¼Œå› æ­¤ä»¥å­—ç¬¦è®¾å¤‡ä¸ºåˆ‡å…¥å£ï¼ŒæŒæ¡å†…æ ¸ä¸ç”¨æˆ·å±‚ä¹‹é—´çš„è°ƒç”¨æœºåˆ¶æ˜¯å†åˆé€‚ä¸è¿‡äº†ã€‚ æœ¬ç« ä¸»è¦å­¦ä¹ ï¼š  å­—ç¬¦è®¾å¤‡é©±åŠ¨çš„åŸºæœ¬æ¦‚å¿µ å¦‚ä½•å‘å†…æ ¸æ³¨å†Œ">
<meta property="og:type" content="article">
<meta property="og:title" content="å››ï¼šå­—ç¬¦è®¾å¤‡">
<meta property="og:url" content="https://ixx.life/ArmLinuxDriver/chapter4/index.html">
<meta property="og:site_name" content="è‡ªå¢äººç”Ÿ">
<meta property="og:description" content="ç”±äºLinuxä¸­ä¸€åˆ‡çš†æ–‡ä»¶çš„æ€æƒ³ï¼Œå­—ç¬¦è®¾å¤‡(é”®ç›˜&#x2F;é¼ æ ‡&#x2F;ä¸²å£)ã€å—è®¾å¤‡(å­˜å‚¨å™¨)ã€ç½‘ç»œè®¾å¤‡(å¥—æ¥å­—)ä½œä¸ºä¸‰ç§ä¸»è¦è®¾å¤‡ç±»å‹ï¼Œæˆ‘ä»¬åœ¨ç”¨æˆ·å±‚åŸºæœ¬å¯ä»¥é€šè¿‡open close read writeæ¥å®Œæˆå¯¹è®¾å¤‡çš„ç»å¤§éƒ¨åˆ†æ“ä½œã€‚å…¶ä¸­å­—ç¬¦è®¾å¤‡æ˜¯æ¶µç›–é¢æœ€å¹¿çš„ä¸€ç§ï¼Œè€Œä¸”å…¶æ¦‚å¿µç›¸å¯¹å®¹æ˜“ç†è§£ï¼Œå› æ­¤ä»¥å­—ç¬¦è®¾å¤‡ä¸ºåˆ‡å…¥å£ï¼ŒæŒæ¡å†…æ ¸ä¸ç”¨æˆ·å±‚ä¹‹é—´çš„è°ƒç”¨æœºåˆ¶æ˜¯å†åˆé€‚ä¸è¿‡äº†ã€‚ æœ¬ç« ä¸»è¦å­¦ä¹ ï¼š  å­—ç¬¦è®¾å¤‡é©±åŠ¨çš„åŸºæœ¬æ¦‚å¿µ å¦‚ä½•å‘å†…æ ¸æ³¨å†Œ">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-04-18T14:18:03.000Z">
<meta property="article:modified_time" content="2021-07-21T22:56:15.017Z">
<meta property="article:author" content="Philon">
<meta property="article:tag" content="ARM">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="é©±åŠ¨å¼€å‘">
<meta property="article:tag" content="åµŒå…¥å¼">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://ixx.life/ArmLinuxDriver/chapter4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>å››ï¼šå­—ç¬¦è®¾å¤‡ | è‡ªå¢äººç”Ÿ</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">è‡ªå¢äººç”Ÿ</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ä½•ä»¥è§£å¿§ï¼Œå”¯æœ‰ i++</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-books">

    <a href="/books/" rel="section"><i class="fa  fa-book fa-fw"></i>è¯»ä¹¦å†™ä½œ</a>

  </li>
        <li class="menu-item menu-item-notes">

    <a href="/notes/" rel="section"><i class="fa fa-pen fa-fw"></i>å­¦ä¹ ç¬”è®°</a>

  </li>
        <li class="menu-item menu-item-leetcode">

    <a href="/leetcode/" rel="section"><i class="fa fa-fire fa-fw"></i>LeetCode</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ixx.life/ArmLinuxDriver/chapter4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Philon">
      <meta itemprop="description" content="ä¸€ä¸ªç¨‹åºå‘˜çš„æˆé•¿è¶³è¿¹">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="è‡ªå¢äººç”Ÿ">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          å››ï¼šå­—ç¬¦è®¾å¤‡
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2019-04-18 22:18:03" itemprop="dateCreated datePublished" datetime="2019-04-18T22:18:03+08:00">2019-04-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ARM-Linux%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">ARM-Linuxé©±åŠ¨å¼€å‘</span></a>
                </span>
            </span>

          
            <span id="/ArmLinuxDriver/chapter4/" class="post-meta-item leancloud_visitors" data-flag-title="å››ï¼šå­—ç¬¦è®¾å¤‡" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valineï¼š</span>
    
    <a title="valine" href="/ArmLinuxDriver/chapter4/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/ArmLinuxDriver/chapter4/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>ç”±äºLinuxä¸­<code>ä¸€åˆ‡çš†æ–‡ä»¶</code>çš„æ€æƒ³ï¼Œå­—ç¬¦è®¾å¤‡(é”®ç›˜/é¼ æ ‡/ä¸²å£)ã€å—è®¾å¤‡(å­˜å‚¨å™¨)ã€ç½‘ç»œè®¾å¤‡(å¥—æ¥å­—)ä½œä¸ºä¸‰ç§ä¸»è¦è®¾å¤‡ç±»å‹ï¼Œæˆ‘ä»¬åœ¨ç”¨æˆ·å±‚åŸºæœ¬å¯ä»¥é€šè¿‡<code>open close read write</code>æ¥å®Œæˆå¯¹è®¾å¤‡çš„ç»å¤§éƒ¨åˆ†æ“ä½œã€‚å…¶ä¸­å­—ç¬¦è®¾å¤‡æ˜¯æ¶µç›–é¢æœ€å¹¿çš„ä¸€ç§ï¼Œè€Œä¸”å…¶æ¦‚å¿µç›¸å¯¹å®¹æ˜“ç†è§£ï¼Œå› æ­¤ä»¥å­—ç¬¦è®¾å¤‡ä¸ºåˆ‡å…¥å£ï¼ŒæŒæ¡å†…æ ¸ä¸ç”¨æˆ·å±‚ä¹‹é—´çš„è°ƒç”¨æœºåˆ¶æ˜¯å†åˆé€‚ä¸è¿‡äº†ã€‚</p>
<p><strong>æœ¬ç« ä¸»è¦å­¦ä¹ </strong>ï¼š</p>
<ul>
<li>å­—ç¬¦è®¾å¤‡é©±åŠ¨çš„åŸºæœ¬æ¦‚å¿µ</li>
<li>å¦‚ä½•å‘å†…æ ¸æ³¨å†Œ/æ³¨é”€ä¸€ä¸ªå­—ç¬¦è®¾å¤‡</li>
<li>å¦‚ä½•é€šè¿‡è®¾å¤‡èŠ‚ç‚¹ã€æ–‡ä»¶APIè°ƒç”¨é©±åŠ¨çš„å‡½æ•°</li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯å­—ç¬¦è®¾å¤‡ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å­—ç¬¦è®¾å¤‡ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å­—ç¬¦è®¾å¤‡ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å­—ç¬¦è®¾å¤‡ï¼Ÿ</h2><p>æ‰€è°“å­—ç¬¦è®¾å¤‡ï¼Œæ³›æŒ‡é‚£äº›è¾“å…¥è¾“å‡ºä»¥ä¸²è¡Œæ–¹å¼ã€æŒ‰é¡ºåºã€ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦çš„æ”¶å‘æ•°æ®çš„è®¾å¤‡ã€‚æ¯”å¦‚é”®ç›˜ï¼ŒæŒ‰é”®æ•°æ®æ˜¯ä¸€ä¸ªä¸€ä¸ªå‘ç»™ç³»ç»Ÿçš„ï¼Œå“ªæ€•æ˜¯ç»„åˆé”®ï¼›é¼ æ ‡çš„åæ ‡ï¼›LEDç¯ï¼›ä¸²å£ç»ˆç«¯ç­‰ã€‚è€Œè¿™äº›æ•°æ®å¦‚æœä¸èƒ½åŠæ—¶è¢«ç³»ç»Ÿå¤„ç†ï¼Œè¦ä¹ˆè¢«ç¼“å­˜ï¼Œè¦ä¹ˆç›´æ¥ä¸¢å¼ƒï¼Œä½†ä¸è®ºå¦‚ä½•ï¼Œå½“ç³»ç»Ÿå»å¤„ç†è¿™äº›æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯æŒ‰å…ˆæ¥ååˆ°çš„é¡ºåºã€‚</p>
<p>ä½ å¯ä»¥è®¾æƒ³ä»¥ä¸‹ï¼Œä½ çš„ç”µè„‘çªç„¶å¡é¡¿äº†5ç§’é’Ÿï¼Œè€Œè¿™æœŸé—´ä½ ç–¯ç‹‚æ‰“äº†10ä¸ªå­—ï¼Œæ¯«æ— ç–‘é—®è¿™10ä¸ªå­—çš„æ•°æ®è¢«ç¼“å­˜èµ·æ¥äº†ï¼Œç­‰ç³»ç»Ÿç©ºé—²çš„æ—¶å€™å¼€å§‹å¤„ç†å®ƒä»¬ï¼Œç°åœ¨ä½ æ˜¯å¸Œæœ›è¿™10ä¸ªå­—æ˜¯æŒ‰ç…§ä½ æ‰“çš„é¡ºåºå‡ºç°åœ¨å±å¹•å‘¢ï¼Œè¿˜æ˜¯å¸Œæœ›å®ƒä»¬æ¯«æ— ç« æ³•åœ°å‡ºç°åœ¨å±å¹•ã€‚</p>
<p>æ‰€ä»¥ï¼Œå­—ç¬¦è®¾å¤‡ï¼Œå°±æ˜¯æ•°æ®çš„IOæ€»æ˜¯ä»¥è¿ç»­çš„å½¢å¼å¤„ç†çš„è®¾å¤‡ç±»å‹ã€‚</p>
<p>é¡ºå¸¦æä¸€å¥å—è®¾å¤‡ï¼Œä¸å­—ç¬¦è®¾å¤‡æ¦‚å¿µåšä¸ªå¯¹æ¯”ã€‚æ¯”å¦‚ç¡¬ç›˜ï¼šä½ å’Œä½ çš„å³æ‰‹å‡ºå»çº¦ä¼šå¹¶æ‹äº†å¾ˆå¤šç…§ç‰‡å›æ¥ï¼Œç„¶åä½ æŠŠç…§ç‰‡å¯¼å…¥ç”µè„‘ï¼Œè€Œç¡¬ç›˜çš„å­˜å‚¨ç©ºé—´å¹¶ä¸æ˜¯åƒæ°´æ¯ä¸€æ ·ä»ä¸‹å¾€ä¸ŠæŒ‰é¡ºåºå¡«æ»¡ï¼Œè€Œæ˜¯æ ¹æ®æŸç§ç®—æ³•â€œéšæœºâ€å­˜ï¼Œæ‰€ä»¥åœ¨çœŸå®çš„ç¡¬ç›˜ä¸­ï¼Œå­˜æ”¾ä½ 1å·ç…§ç‰‡çš„å­˜å‚¨åŒºåŸŸæ—è¾¹ï¼Œå¹¶ä¸æ˜¯2å·ç…§ç‰‡ï¼Œå¯èƒ½æ˜¯æŸä»½æ—¥è¯­å­¦ä¹ èµ„æ–™ï¼›åŒç†ï¼Œ3å·ç…§ç‰‡å¯èƒ½ä¸å»å¹´ä¸‹è½½çš„ç§å­å‘†åœ¨ä¸€èµ·ã€‚</p>
<h2 id="ç¬¬ä¸€ä¸ªå­—ç¬¦è®¾å¤‡-meme"><a href="#ç¬¬ä¸€ä¸ªå­—ç¬¦è®¾å¤‡-meme" class="headerlink" title="ç¬¬ä¸€ä¸ªå­—ç¬¦è®¾å¤‡ meme"></a>ç¬¬ä¸€ä¸ªå­—ç¬¦è®¾å¤‡ meme</h2><p>åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œè®¾å¤‡ä¸ä¸€å®šè¦çœŸå®å­˜åœ¨ï¼Œè™šæ‹Ÿè®¾å¤‡ä¹Ÿæ˜¯è®¾å¤‡ï¼Œå¯ä»¥é€šè¿‡æ–‡ä»¶å‡½æ•°è¿›è¡Œæ“ä½œã€‚å› æ­¤ä¸ºäº†æŒæ¡å­—ç¬¦è®¾å¤‡çš„çŸ¥è¯†ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯è‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªè™šæ‹Ÿå­—ç¬¦è®¾å¤‡ã€‚</p>
<p>memeçš„ä¸­æ–‡æ„æ€æ˜¯ç±³å§†ã€è«å› ï¼Œè¡¨ç¤ºæ–‡åŒ–DNAçš„æ„æ€ï¼Œè€Œä½œä¸ºæˆ‘å­¦ä¹ é©±åŠ¨çš„å®ä¾‹ï¼Œå®ƒå°±æ˜¯â€œè®°äº‹æœ¬â€ï¼Œç”¨æˆ·å¯ä»¥ç”¨å¤šç§æ–¹å¼è¯»å†™å®ƒï¼Œè€Œæˆ‘ç»™è¿™ä¸ªè™šæ‹Ÿè®¾å¤‡å–è¿™ä¹ˆä¸ªåå­—æ²¡åˆ«çš„æ„æ€â€”â€”just for funï¼</p>
<p>å…ˆæ¥çœ‹çœ‹æˆ‘æ‰“ç®—è¦memeå®ç°å“ªäº›å†…å®¹ï¼š</p>
<ol>
<li>å‘å†…æ ¸æ³¨å†Œ/æ³¨é”€è‡ªå·±</li>
<li>æ”¯æŒopen/close/read/writeç­‰æ–‡ä»¶æ“ä½œå‡½æ•°</li>
</ol>
<h3 id="å­—ç¬¦è®¾å¤‡çš„æ³¨å†Œä¸æ³¨é”€"><a href="#å­—ç¬¦è®¾å¤‡çš„æ³¨å†Œä¸æ³¨é”€" class="headerlink" title="å­—ç¬¦è®¾å¤‡çš„æ³¨å†Œä¸æ³¨é”€"></a>å­—ç¬¦è®¾å¤‡çš„æ³¨å†Œä¸æ³¨é”€</h3><p>è¦åƒå†…æ ¸æ³¨å†Œä¸€ä¸ªè®¾å¤‡ï¼Œå¿…é¡»æä¾›å®ƒçš„è®¾å¤‡å·ä½œä¸ºå”¯ä¸€æ ‡ç¤ºï¼Œå­—ç¬¦è®¾å¤‡çš„è®¾å¤‡å·ç”±<strong>ä¸»è®¾å¤‡å·</strong>å’Œ<strong>æ¬¡è®¾å¤‡å·</strong>å…±åŒç»„æˆ</p>
<ul>
<li>ä¸»è®¾å¤‡å·(major)ï¼šè¡¨ç¤ºè®¾å¤‡çš„åˆ†ç±»ç¼–å·ï¼Œæ¯”å¦‚1ä»£è¡¨uç›˜ã€2ä»£è¡¨æ˜¾ç¤ºå™¨ã€3ä»£è¡¨æ‰“å°æœº</li>
<li>æ¬¡è®¾å¤‡å·(minor)ï¼šè¡¨ç¤ºåŒä¸€åˆ†ç±»çš„å®ä¾‹ç¼–å·ï¼Œæ¯”å¦‚1å·uç›˜ã€2å·uç›˜ã€3å·uç›˜</li>
</ul>
<p>Linuxå†…æ ¸å¯ä»¥<strong>é™æ€æ³¨å†Œ</strong>å’Œ<strong>åŠ¨æ€åˆ†é…</strong>çš„æ–¹å¼æ³¨å†Œä¸€ä¸ªè®¾å¤‡å·ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€ç”³è¯·ï¼Œç”±å†…æ ¸è‡ªåŠ¨æ‰«æç©ºé—²è®¾å¤‡å·ç»™å®ƒ</span></span><br><span class="line"><span class="comment">// @dev         è®¾å¤‡ç¼–å·</span></span><br><span class="line"><span class="comment">// @firstminor  æ¬¡è®¾å¤‡å·çš„èµ·å§‹ç¼–å·</span></span><br><span class="line"><span class="comment">// @count       è¦ç”³è¯·å¤šå°‘ä¸ªè¿ç»­çš„è®¾å¤‡å·</span></span><br><span class="line"><span class="comment">// @name        è®¾å¤‡åç§°ï¼Œå°†å‡ºç°åœ¨/proc/devicesä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">alloc_chrdev_region</span><span class="params">(<span class="keyword">dev_t</span> *dev, <span class="keyword">unsigned</span> firstminor, <span class="keyword">unsigned</span> count, <span class="keyword">const</span> <span class="keyword">char</span> *name)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é™æ€æ³¨å†Œï¼Œå¿…é¡»ç¡®ä¿è¯¥è®¾å¤‡å·æ˜¯ç©ºé—²çš„</span></span><br><span class="line"><span class="comment">// @first   è¦æ³¨å†Œçš„èµ·å§‹è®¾å¤‡å·ï¼Œä¸»+æ¬¡</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">register_chrdev_region</span><span class="params">(<span class="keyword">dev_t</span> first, <span class="keyword">unsigned</span> count, <span class="keyword">const</span> <span class="keyword">char</span> *name)</span></span>;</span><br></pre></td></tr></table></figure>

<p>âš ï¸æ³¨æ„âš ï¸ï¼šåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¼ºçƒˆå»ºè®®ä»…é€šè¿‡<strong>åŠ¨æ€åˆ†é…</strong>çš„æ–¹å¼æ³¨å†Œè®¾å¤‡ï¼Œå› ä¸ºè¯´ä¸å‡†ä½ è‡ªå·±è§„åˆ’å¥½çš„è®¾å¤‡ç¼–å·ä¼šåœ¨æœªæ¥è¢«Linuxå†…æ ¸ç»™å ç”¨äº†ã€‚</p>
<p>å­—ç¬¦è®¾å¤‡çš„æ³¨å†Œå¤§ä½“åˆ†ä¸¤æ­¥ï¼š</p>
<ol>
<li>åˆå§‹åŒ–ä¸€ä¸ª<code>cdev</code>å­—ç¬¦è®¾å¤‡çš„æ•°æ®ç»“æ„ï¼Œå‘å†…æ ¸è¯´æ˜è‡ªå·±æ˜¯å­—ç¬¦è®¾å¤‡</li>
<li>åˆ†é…ä¸€ä¸ªè®¾å¤‡å·ä¸cdevç»‘å®šèµ·æ¥</li>
</ol>
<p>ä¸‹é¢å°±æ˜¯ä¸€ä¸ªæœ€çº¯ç²¹çš„å­—ç¬¦è®¾å¤‡æ³¨å†Œå’Œæ³¨é”€çš„å®ç°ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/cdev.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å­—ç¬¦è®¾å¤‡ç»“æ„ä½“ï¼Œè¯¥å­—ç¬¦è®¾å¤‡çš„æ ¸å¿ƒæ•°æ®è¡¨ç¤º</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">cdev</span> <span class="title">cdev</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é©±åŠ¨çš„ä¸»è®¾å¤‡ç¼–å·ï¼Œæ¯ç§ç±»å‹çš„è®¾å¤‡éƒ½æœ‰å”¯ä¸€ç¼–å·</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">dev_t</span> devno = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å—åŠ è½½å‡½æ•°ï¼šæ³¨å†Œå­—ç¬¦è®¾å¤‡</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> __init <span class="title">meme_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1. å‘å†…æ ¸ç”³è¯·åˆ†é…ä¸€ä¸ªä¸»è®¾å¤‡å·ï¼Œæ­¤è®¾å¤‡å·ä»0å¼€å§‹ï¼Œåˆ†é…1ä¸ªï¼Œåç§°ä¸ºmeme</span></span><br><span class="line">    <span class="keyword">if</span> (alloc_chrdev_region(&amp;devno, <span class="number">0</span>, <span class="number">1</span>, <span class="string">&quot;meme&quot;</span>) &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">        printk(KERN_ERR<span class="string">&quot;init fail\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. åˆå§‹åŒ–cdevç»“æ„ä½“ï¼Œå¹¶ä¸fopsæ–‡ä»¶æ“ä½œä¹‹é—´å»ºç«‹è”ç³»</span></span><br><span class="line">    cdev_init(&amp;cdev, &amp;fops);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æ­£å¼å‘å†…æ ¸æ³¨å†Œä¸€ä¸ªå­—ç¬¦è®¾å¤‡</span></span><br><span class="line">    cdev_add(&amp;cdev, devno, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨å†ŒæˆåŠŸåæ‰“å°å‡ºè¯¥è®¾å¤‡çš„ä¸»ã€æ¬¡è®¾å¤‡å·</span></span><br><span class="line">    printk(KERN_ALERT<span class="string">&quot;meme init: %d:%d\n&quot;</span>, MAJOR(devno), MINOR(devno));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">module_init(meme_init);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å—å¸è½½å‡½æ•°ï¼šæ³¨é”€å­—ç¬¦è®¾å¤‡</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> __exit <span class="title">meme_exit</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1. å‘å†…æ ¸æ³¨é”€è¯¥å­—ç¬¦è®¾å¤‡</span></span><br><span class="line">    cdev_del(&amp;cdev);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. å‘å†…æ ¸ç”³è¯·é‡Šæ”¾è¯¥è®¾å¤‡å·</span></span><br><span class="line">    unregister_chrdev_region(devno, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    printk(<span class="string">&quot;meme free\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">module_exit(meme_exit);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‚ä¸ƒæ‚å…«çš„ä¸œè¥¿</span></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL v2&quot;</span>);</span><br><span class="line">MODULE_AUTHOR(<span class="string">&quot;Philon&quot;</span>);</span><br><span class="line">MODULE_DESCRIPTION(<span class="string">&quot;A character device driver&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå­—ç¬¦è®¾å¤‡çš„æ³¨å†Œ/æ³¨é”€ä¸€èˆ¬æ˜¯åœ¨æ¨¡å—çš„åŠ è½½å’Œå¸è½½å‡½æ•°ä¸­å®ç°çš„ï¼Œæ•´ä¸ªè¿‡ç¨‹éå¸¸ç®€å•ï¼š<br>ç”³è¯·è®¾å¤‡å· â€“&gt; åˆå§‹åŒ–å­—ç¬¦è®¾å¤‡ â€“&gt; å†…æ ¸æ·»åŠ å­—ç¬¦è®¾å¤‡ â€“&gt; å†…æ ¸åˆ é™¤å­—ç¬¦è®¾å¤‡ â€“&gt; é‡Šæ”¾è®¾å¤‡å·</p>
<p>å…³äº<code>cdev_init / cdev_add / cdev_del</code>ç­‰å‡½æ•°æ²¡æœ‰å±•å¼€è¯´æ˜æ˜¯å› ä¸ºåç»­æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œä¸è¦æ‹˜æ³¥äºæ­¤ã€‚ä¸è¿‡æ³¨æ„<code>cdev_init(&amp;cdev, &amp;fops)</code>è¿™è¡Œï¼Œfopsæ˜¯æ¥ä¸‹æ¥è¦å­¦ä¹ çš„ä¸€ä¸ªéå¸¸é‡è¦çš„æ•°æ®ç»“æ„â€”â€”<strong>æ–‡ä»¶æ“ä½œ</strong>ã€‚</p>
<h2 id="å­—ç¬¦è®¾å¤‡çš„æ–‡ä»¶æ“ä½œ"><a href="#å­—ç¬¦è®¾å¤‡çš„æ–‡ä»¶æ“ä½œ" class="headerlink" title="å­—ç¬¦è®¾å¤‡çš„æ–‡ä»¶æ“ä½œ"></a>å­—ç¬¦è®¾å¤‡çš„æ–‡ä»¶æ“ä½œ</h2><p>å› ä¸ºLinuxçš„ä¸€åˆ‡çš†æ–‡ä»¶ï¼Œç†è®ºä¸Šåœ¨ç”¨æˆ·å±‚ä»»ä½•è®¾å¤‡éƒ½å¯ä»¥é€šè¿‡æ–‡ä»¶ç›¸å…³çš„APIå‡½æ•°è°ƒç”¨è®¾å¤‡ï¼Œè€Œä½œä¸ºè®¾å¤‡é©±åŠ¨æœ¬èº«ï¼Œå¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†å·¥ä½œå°±æ˜¯æŠŠç”¨æˆ·å±‚çš„å„ç§æ–‡ä»¶æ“ä½œå…³è”åˆ°å„ç§é©±åŠ¨å‡½æ•°å½“ä¸­ï¼Œè€Œè¿™ç¦»ä¸å¼€ä¸€ä¸ªç»“æ„ä½“<code>struct file_operations</code>ï¼Œå…ˆæ¥çœ‹çœ‹å†…æ ¸å¯¹å…¶å®šä¹‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">file_operations</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">module</span> *<span class="title">owner</span>;</span></span><br><span class="line">        <span class="keyword">loff_t</span> (*llseek) (struct file *, <span class="keyword">loff_t</span>, <span class="keyword">int</span>);</span><br><span class="line">        <span class="keyword">ssize_t</span> (*read) (struct file *, <span class="keyword">char</span> __user *, <span class="keyword">size_t</span>, <span class="keyword">loff_t</span> *);</span><br><span class="line">        <span class="keyword">ssize_t</span> (*write) (struct file *, <span class="keyword">const</span> <span class="keyword">char</span> __user *, <span class="keyword">size_t</span>, <span class="keyword">loff_t</span> *);</span><br><span class="line">        <span class="keyword">ssize_t</span> (*read_iter) (struct kiocb *, struct iov_iter *);</span><br><span class="line">        <span class="keyword">ssize_t</span> (*write_iter) (struct kiocb *, struct iov_iter *);</span><br><span class="line">        <span class="keyword">int</span> (*iterate) (struct file *, struct dir_context *);</span><br><span class="line">        <span class="keyword">int</span> (*iterate_shared) (struct file *, struct dir_context *);</span><br><span class="line">        <span class="keyword">__poll_t</span> (*poll) (struct file *, struct poll_table_struct *);</span><br><span class="line">        <span class="keyword">long</span> (*unlocked_ioctl) (struct file *, <span class="keyword">unsigned</span> <span class="keyword">int</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>);</span><br><span class="line">        <span class="keyword">long</span> (*compat_ioctl) (struct file *, <span class="keyword">unsigned</span> <span class="keyword">int</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>);</span><br><span class="line">        <span class="keyword">int</span> (*mmap) (struct file *, struct vm_area_struct *);</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">long</span> mmap_supported_flags;</span><br><span class="line">        <span class="keyword">int</span> (*open) (struct inode *, struct file *);</span><br><span class="line">        <span class="keyword">int</span> (*flush) (struct file *, <span class="keyword">fl_owner_t</span> id);</span><br><span class="line">        <span class="keyword">int</span> (*release) (struct inode *, struct file *);</span><br><span class="line">        <span class="keyword">int</span> (*fsync) (struct file *, <span class="keyword">loff_t</span>, <span class="keyword">loff_t</span>, <span class="keyword">int</span> datasync);</span><br><span class="line">        <span class="keyword">int</span> (*fasync) (<span class="keyword">int</span>, struct file *, <span class="keyword">int</span>);</span><br><span class="line">        <span class="keyword">int</span> (*lock) (struct file *, <span class="keyword">int</span>, struct file_lock *);</span><br><span class="line">        <span class="keyword">ssize_t</span> (*sendpage) (struct file *, struct page *, <span class="keyword">int</span>, <span class="keyword">size_t</span>, <span class="keyword">loff_t</span> *, <span class="keyword">int</span>);</span><br><span class="line">        <span class="function"><span class="keyword">unsigned</span> <span class="title">long</span> <span class="params">(*get_unmapped_area)</span><span class="params">(struct file *, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">unsigned</span> <span class="keyword">long</span>)</span></span>;</span><br><span class="line">        <span class="keyword">int</span> (*check_flags)(<span class="keyword">int</span>);</span><br><span class="line">        <span class="keyword">int</span> (*flock) (struct file *, <span class="keyword">int</span>, struct file_lock *);</span><br><span class="line">        <span class="keyword">ssize_t</span> (*splice_write)(struct pipe_inode_info *, struct file *, <span class="keyword">loff_t</span> *, <span class="keyword">size_t</span>, <span class="keyword">unsigned</span> <span class="keyword">int</span>);</span><br><span class="line">        <span class="keyword">ssize_t</span> (*splice_read)(struct file *, <span class="keyword">loff_t</span> *, struct pipe_inode_info *, <span class="keyword">size_t</span>, <span class="keyword">unsigned</span> <span class="keyword">int</span>);</span><br><span class="line">        <span class="keyword">int</span> (*setlease)(struct file *, <span class="keyword">long</span>, struct file_lock **, <span class="keyword">void</span> **);</span><br><span class="line">        <span class="keyword">long</span> (*fallocate)(struct file *file, <span class="keyword">int</span> mode, <span class="keyword">loff_t</span> offset,</span><br><span class="line">                          <span class="keyword">loff_t</span> len);</span><br><span class="line">        <span class="keyword">void</span> (*show_fdinfo)(struct seq_file *m, struct file *f);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CONFIG_MMU</span></span><br><span class="line">        <span class="keyword">unsigned</span> (*mmap_capabilities)(struct file *);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">        <span class="keyword">ssize_t</span> (*copy_file_range)(struct file *, <span class="keyword">loff_t</span>, struct file *,</span><br><span class="line">                        <span class="keyword">loff_t</span>, <span class="keyword">size_t</span>, <span class="keyword">unsigned</span> <span class="keyword">int</span>);</span><br><span class="line">        <span class="keyword">loff_t</span> (*remap_file_range)(struct file *file_in, <span class="keyword">loff_t</span> pos_in,</span><br><span class="line">                                   struct file *file_out, <span class="keyword">loff_t</span> pos_out,</span><br><span class="line">                                   <span class="keyword">loff_t</span> len, <span class="keyword">unsigned</span> <span class="keyword">int</span> remap_flags);</span><br><span class="line">        <span class="keyword">int</span> (*fadvise)(struct file *, <span class="keyword">loff_t</span>, <span class="keyword">loff_t</span>, <span class="keyword">int</span>);</span><br><span class="line">&#125; __randomize_layout;</span><br></pre></td></tr></table></figure>

<p>ä¹ä¸€çœ‹ï¼Œå¾ˆå¤æ‚ï¼å…¶å®ç”¨é¢å‘å¯¹è±¡çš„æ€ç»´å¯ä»¥ç®€å•ç†è§£ä¸ºâ€”â€”<strong>file_operationså°±æ˜¯ä¸€ä¸ªéœ€è¦ç»§æ‰¿å®ç°çš„interface</strong>ã€‚å› æ­¤ä¸è¦å»çº ç»“é‡Œé¢çš„å†…å®¹æœ‰å¤šå°‘ï¼Œå¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬éƒ½æ˜¯æ ¹æ®éœ€è¦å»å®ç°å…¶ä¸­çš„éƒ¨åˆ†å‡½æ•°å³å¯ï¼Œç­‰å…·ä½“å®ç°çš„æ—¶å€™å†æ¥å‚è€ƒå¯¹åº”å‡½æ•°åœ¨å…¶ä¸­çš„å£°æ˜å½¢å¼ã€‚(é€šè¿‡è¯¥ç»“æ„ä½“æ‰“é€šäº†å†…æ ¸ä¸åº”ç”¨é—´çš„ä»»ç£äºŒè„‰)</p>
<h3 id="ä¸ºç”¨æˆ·å±‚å®ç°open-closeå’Œread-write"><a href="#ä¸ºç”¨æˆ·å±‚å®ç°open-closeå’Œread-write" class="headerlink" title="ä¸ºç”¨æˆ·å±‚å®ç°open/closeå’Œread/write"></a>ä¸ºç”¨æˆ·å±‚å®ç°open/closeå’Œread/write</h3><ul>
<li>openå’Œcloseä¸€èˆ¬éƒ½æ˜¯å¤„ç†ä¸€äº›è®¾å¤‡å¤ä½çš„å·¥ä½œ(æˆ–è€…å¹²è„†ä¸åšä»»ä½•å¤„ç†)ï¼Œä½†å¦‚æœæœ‰é€»è¾‘è¦æ”¾åœ¨open/closeé‡Œæ‰§è¡Œï¼ŒåŠ¡å¿…ç•™æ„åº”ç”¨ç¨‹åºå¯èƒ½ä¼šé‡å¤å¤šæ¬¡æ‰“å¼€/å…³é—­åŒä¸€ä¸ªæ–‡ä»¶çš„æƒ…å†µã€‚</li>
<li>read/writeåœ¨å†…æ ¸ä¸­ä¸»è¦å›´ç»•<code>copy_to_user</code>å’Œ<code>copy_from_user</code>ä¸¤ä¸ªå‡½æ•°æ¥å¤„ç†ï¼Œå®ƒä»¬è´Ÿè´£æŠŠâ€œäº¤æ¢â€ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸æ¨¡å—çš„æ•°æ®ï¼Œä½†è¦ç‰¹åˆ«å°å¿ƒ<strong>æ–‡ä»¶åç§»ï¼Œä¸æ˜¯æ‰€æœ‰è®¾å¤‡åœ¨è¯»å†™çš„æ—¶å€™éƒ½éœ€è¦åç§»çš„</strong>ï¼æ¯”å¦‚è¯»å–LEDç¯çš„çŠ¶æ€ï¼Œæ¯æ¬¡éƒ½åº”è¯¥ä»å¤´å¼€å§‹è¯»ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¹åº”ç”¨æˆ·å±‚readè¯»å–å‡½æ•°ï¼Œé€šå¸¸ç”¨æˆ·æ¥æ”¶è®¾å¤‡å†…å®¹ï¼Œå¦‚ä¸²å£æ”¶æ•°æ®</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">ssize_t</span> <span class="title">meme_read</span><span class="params">(struct file* filp, <span class="keyword">char</span> __user *buf, <span class="keyword">size_t</span> size, <span class="keyword">loff_t</span>* off)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰æ–‡ä»¶åç§»é‡å·²ç»è¶…å‡ºå†…å­˜å¤§å°ï¼Œç›´æ¥è¿”å›é”™è¯¯</span></span><br><span class="line">    <span class="keyword">if</span> (*off &gt;= meme.size) &#123;</span><br><span class="line">        <span class="keyword">return</span> -ENOMEM;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰å¯è®¿é—®å†…å­˜é•¿åº¦å°äºè¦è¯»å–çš„é•¿åº¦ï¼Œä»…è¯»å–å¯è®¿é—®é•¿åº¦</span></span><br><span class="line">    <span class="keyword">if</span> ((*off + size) &gt; meme.size) &#123;</span><br><span class="line">        size = meme.size - *off;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‹·è´å†…æ ¸æ•°æ®åˆ°ç”¨æˆ·ç©ºé—´</span></span><br><span class="line">    <span class="keyword">if</span> (copy_to_user(buf, filp-&gt;private_data + *off, size)) &#123;</span><br><span class="line">        <span class="keyword">return</span> -EFAULT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åç§»ç›¸åº”çš„è¯»å–é•¿åº¦</span></span><br><span class="line">    *off += size;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹åº”ç”¨æˆ·å±‚writeå†™å…¥å‡½æ•°ï¼Œé€šå¸¸ç”¨äºå†™å…¥è®¾å¤‡å†…å®¹ï¼Œå¦‚ä¸²å£å‘æ•°æ®</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">ssize_t</span> <span class="title">meme_write</span><span class="params">(struct file* filp, <span class="keyword">const</span> <span class="keyword">char</span> __user *buf, <span class="keyword">size_t</span> size, <span class="keyword">loff_t</span>* off)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ–‡ä»¶åç§»è¶…å‡ºå†…å­˜é•¿åº¦ï¼Œå°±æ²¡å¿…è¦å†å†™äº†</span></span><br><span class="line">    <span class="keyword">if</span> (*off &gt;= meme.size) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœè¦å†™å…¥çš„æ•°æ®é•¿åº¦æ¯”å‰©ä½™å¯è®¿é—®çš„å†…å­˜é•¿åº¦è¿˜è¦å¤§ï¼Œä»…å†™å…¥å¯è®¿é—®çš„å†…å­˜é•¿åº¦</span></span><br><span class="line">    <span class="keyword">if</span> (*off + size &gt; meme.size) &#123;</span><br><span class="line">        size = meme.size - *off;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‹·è´ç”¨æˆ·æ•°æ®åˆ°å†…æ ¸ç©ºé—´</span></span><br><span class="line">    <span class="keyword">if</span> (copy_from_user(filp-&gt;private_data + *off, buf, size)) &#123;</span><br><span class="line">        <span class="keyword">return</span> -EFAULT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åç§»ç›¸åº”çš„å†™å…¥å‡½æ•°</span></span><br><span class="line">    *off += size;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹åº”ç”¨æˆ·å±‚openæ‰“å¼€å‡½æ•°ï¼Œå°±æ˜¯æ‰“å¼€è®¾å¤‡æè¿°ç¬¦</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">meme_open</span><span class="params">(struct inode* inode, struct file* filp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è®¿é—®è®¾å¤‡èŠ‚ç‚¹ï¼Œåˆ†é…å†…å­˜</span></span><br><span class="line">    <span class="keyword">if</span> (meme.data == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        meme.data = kmalloc(MEME_DEFAULT_DATA_SIZE, GFP_KERNEL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    filp-&gt;private_data = meme.data;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹åº”ç”¨æˆ·å±‚closeå…³é—­å‡½æ•°ï¼Œå°±æ˜¯å…³é—­è®¾å¤‡æ–‡ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">meme_close</span><span class="params">(struct inode* inode, struct file* filp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// nothing todo</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–‡ä»¶æ“ä½œç»“æ„ä½“ï¼Œè¡¨ç¤ºå†…æ ¸æ¨¡å—ä¸ç”¨æˆ·å±‚çš„å‡½æ•°å¯¹åº”å…³ç³»</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">file_operations</span> <span class="title">fops</span> =</span> &#123;</span><br><span class="line">    .owner = THIS_MODULE, <span class="comment">// è¿™å…¶å®æ˜¯ä¸ªç»“æ„ä½“ï¼Œæ¯”å¦‚THIS_MODULE-&gt;name</span></span><br><span class="line">    .read = meme_read,</span><br><span class="line">    .write = meme_write,</span><br><span class="line">    .open = meme_open,</span><br><span class="line">    .release = meme_close,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä»£ç å¾ˆç®€å•ï¼Œè¯¥è¯´çš„æ³¨é‡Šéƒ½å·²ç»è¯´äº†ï¼Œé™¤äº†file_operationsé‡Œçš„è¿™å¥ï¼š<code>.owner = THIS_MODULE</code>ã€‚é¦–å…ˆè¦ç›´åˆ°THIS_MODULEæ˜¯ä¸€ä¸ªç»“æ„ä½“å®šä¹‰ï¼Œä¹‹æ‰€ä»¥æŠŠå®ƒæŒ‡å‘owner(æ¨¡å—è‡ªèº«)æ˜¯ä¸ºäº†é˜²æ­¢æ¨¡å—æ­£åœ¨è¿›è¡Œå…¶ä»–æ“ä½œ(å¦‚è¯»å†™)æ—¶ï¼Œè¢«rmmodå¸è½½ã€‚æ¯ä¸ªä»¥æ¨¡å—å½¢å¼å­˜åœ¨çš„é©±åŠ¨ï¼Œæœ€å¥½éƒ½æŠŠè¿™å¥åŠ ä¸Šï¼</p>
<h2 id="è®¾å¤‡èŠ‚ç‚¹ä¸æ“ä½œ"><a href="#è®¾å¤‡èŠ‚ç‚¹ä¸æ“ä½œ" class="headerlink" title="è®¾å¤‡èŠ‚ç‚¹ä¸æ“ä½œ"></a>è®¾å¤‡èŠ‚ç‚¹ä¸æ“ä½œ</h2><p>è®¾å¤‡èŠ‚ç‚¹æ˜¯æ˜¯ç”¨æˆ·å±‚ä¸å†…æ ¸æ¨¡å—æ²Ÿé€šçš„æ¡¥æ¢ï¼</p>
<p>ä½œä¸ºåˆå­¦è€…çš„æˆ‘æ›¾ä¸€åº¦è®¤ä¸º/devç›®å½•ä¸‹çš„èŠ‚ç‚¹å°±æ˜¯è®¾å¤‡æœ¬èº«ï¼Œæ˜¾ç„¶è¿™ç§çœ‹æ³•å¾ˆå¹¼ç¨šï¼Œå†…æ ¸çœŸæ­£æŠŠè®¾å¤‡å’Œé©±åŠ¨æš´éœ²åœ¨/procå’Œ/sysç›®å½•(å†è¯´ä¸€éï¼Œå…¶å®æ˜¯æ–‡ä»¶ç³»ç»Ÿï¼ï¼)è€Œè®¾å¤‡èŠ‚ç‚¹æ˜¯åœ¨ç”¨æˆ·å±‚åˆ›å»ºçš„ä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶ï¼Œå®ƒçš„åˆ›å»ºå’Œåˆ é™¤å‡ ä¹ä¸å½±å“å†…æ ¸å¯¹è®¾å¤‡æœ¬èº«çš„ç®¡ç†ã€‚</p>
<p>è®¾å¤‡èŠ‚ç‚¹çš„åˆ›å»ºå‘½ä»¤ä¸ºï¼š<code>mknod &lt;node_name&gt; &lt;type&gt; &lt;major&gt; &lt;minor&gt;</code></p>
<p>æŠŠmemeç¼–è¯‘å¥½ä¹‹åå®é™…æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†é©±åŠ¨æ¨¡å—æ‹·è´åˆ°é•œåƒ</span></span><br><span class="line">$ <span class="built_in">cd</span> ~/varm/os/</span><br><span class="line">$ sudo mount -o loop rootfs.ext3 /mnt</span><br><span class="line">$ sudo cp ../drivers/meme/meme.ko /mnt</span><br><span class="line">$ sudo umount /mnt</span><br><span class="line">$ ./power_on.sh <span class="comment"># å¯åŠ¨varmç³»ç»Ÿ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥ä¸‹æ˜¯qemuè™šæ‹Ÿæœºå†…æ“ä½œ</span></span><br><span class="line">/$ insmod meme.ko </span><br><span class="line">meme: loading out-of-tree module taints kernel.</span><br><span class="line">meme init: 250:0 <span class="comment"># ğŸ‘ˆå­—ç¬¦è®¾å¤‡æ³¨å†ŒæˆåŠŸï¼Œä¸»è®¾å¤‡å·250ï¼Œæ¬¡è®¾å¤‡å·0</span></span><br><span class="line"></span><br><span class="line">/$ cat /proc/devices</span><br><span class="line">Character devices:</span><br><span class="line">  1 mem</span><br><span class="line">  2 pty</span><br><span class="line">  ...</span><br><span class="line">250 meme <span class="comment"># ğŸ‘ˆé€šè¿‡/proc/devicesä¹Ÿå¯ä»¥çœ‹åˆ°æ¨¡å—ä¿¡æ¯</span></span><br><span class="line">251 rpmb</span><br><span class="line">252 usbmon</span><br><span class="line">253 rtc</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹ï¼Œæ ¹æ®è®¾å¤‡å·</span></span><br><span class="line">/$ mknod /dev/meme c 250 0</span><br><span class="line"><span class="comment"># ç”¨echoå‘½ä»¤å†™å†…å®¹åˆ°è®¾å¤‡èŠ‚ç‚¹</span></span><br><span class="line">/$ <span class="built_in">echo</span> <span class="string">&quot;I am Philon, I want to be a creator!&quot;</span> &gt;&gt; /dev/meme </span><br><span class="line"><span class="comment"># ç”¨catå‘½ä»¤ä»è®¾å¤‡èŠ‚ç‚¹è¯»å†…å®¹</span></span><br><span class="line">/$ cat /dev/meme </span><br><span class="line">I am Philon, I want to be a creator! <span class="comment"># ğŸ‘ˆè¯´æ˜è¯»å†™ã€å¼€å…³å‡½æ•°éƒ½æˆåŠŸäº†</span></span><br><span class="line">4 	(?U</span><br><span class="line">           ?U</span><br><span class="line">             ?U</span><br><span class="line">             444  TT?i????~,?~f??</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„æ“ä½œä¸­å¯ä»¥çœ‹åˆ°ï¼Œmemeé©±åŠ¨çš„åŸºæœ¬æ–‡ä»¶æ“ä½œåŠŸèƒ½å·²ç»å…·å¤‡ï¼Œä¹‹æ‰€ä»¥æœ€åè¯»å‡ºæ¥çš„å†…å®¹æœ‰ä¹±ç ï¼Œæ˜¯å› ä¸ºè¿™æ˜¯ä¸€ä¸ªè®¾å¤‡ï¼Œä¸æ˜¯æ™®é€šæ–‡ä»¶ï¼Œè¯¥è®¾å¤‡å¼ºåˆ¶æœ‰<code>0x100</code>çš„å­˜å‚¨ç©ºé—´ï¼Œæ¯æ¬¡éƒ½ä¼šè¢«å…¨éƒ¨è¯»å‡ºæ¥ã€‚</p>
<h2 id="å°ç»“ä¸€ä¸‹"><a href="#å°ç»“ä¸€ä¸‹" class="headerlink" title="å°ç»“ä¸€ä¸‹"></a>å°ç»“ä¸€ä¸‹</h2><ul>
<li>å­—ç¬¦è®¾å¤‡æ˜¯ä¸€ç§é€šè¿‡é¡ºåºè¯»å†™æ¥æ“ä½œçš„è®¾å¤‡</li>
<li>ä¸»è®¾å¤‡å·è¡¨ç¤ºè®¾å¤‡ç±»å‹ï¼Œæ¬¡è®¾å¤‡å·è¡¨ç¤ºè®¾å¤‡å®ä¾‹å·</li>
<li>file_operationså®šä¹‰äº†æ–‡ä»¶æ“ä½œå‡½æ•°çš„æ¥å£</li>
<li>è®¾å¤‡èŠ‚ç‚¹æ˜¯åœ¨ç”¨æˆ·å±‚åˆ›å»ºçš„ç‰¹æ®Šæ–‡ä»¶</li>
</ul>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>Philon
  </li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://ixx.life/ArmLinuxDriver/chapter4/" title="å››ï¼šå­—ç¬¦è®¾å¤‡">https://ixx.life/ArmLinuxDriver/chapter4/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ARM/" rel="tag"># ARM</a>
              <a href="/tags/Linux/" rel="tag"># Linux</a>
              <a href="/tags/%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91/" rel="tag"># é©±åŠ¨å¼€å‘</a>
              <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" rel="tag"># åµŒå…¥å¼</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/97ThingsEveryProgrammerShouldKnow/36/" rel="prev" title="å¤§å¸ˆç¥è¯">
      <i class="fa fa-chevron-left"></i> å¤§å¸ˆç¥è¯
    </a></div>
      <div class="post-nav-item">
    <a href="/books/%E5%A4%A7%E6%B8%85%E7%9B%B8%E5%9B%BD/" rel="next" title="è¯†æ—¶åŠ¡è€…â€”â€”ã€Šå¤§æ¸…ç›¸å›½ã€‹ä¹¦è¯„">
      è¯†æ—¶åŠ¡è€…â€”â€”ã€Šå¤§æ¸…ç›¸å›½ã€‹ä¹¦è¯„ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Philon"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Philon</p>
  <div class="site-description" itemprop="description">ä¸€ä¸ªç¨‹åºå‘˜çš„æˆé•¿è¶³è¿¹</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">177</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">77</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/philon" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;philon" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ixx.life</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'Y5scg9Ix4iae04UOae0uJSJA-gzGzoHsz',
      appKey     : 'U9hHApgNVDExYRJqXvUs5ykr',
      placeholder: "è¯´ç‚¹ä»€ä¹ˆå§...",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
